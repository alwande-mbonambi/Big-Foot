<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Successful!</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/client_side.css') }}">
    <style>
        body { display: flex; justify-content: center; align-items: center; height: 100vh; text-align: center; }
        .message-box { padding: 40px; background: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .message-box h1 { color: #28a745; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="message-box">
        <h1>Thank You For Your Order!</h1>
        <p>Your payment was successful and your order is being processed.</p>
        <p>You can view your order in your profile or return to the store.</p>
        <br>
        <a href="{{ url_for('client_side') }}" class="checkout-button">Return to Store</a>
    </div>

    <script>
        // Get the cart and existing orders from localStorage
        const cart = JSON.parse(localStorage.getItem('bigfootCart')) || [];
        const orders = JSON.parse(localStorage.getItem('bigfootOrders')) || [];
        const userEmail = sessionStorage.getItem('userEmail') || 'guest';

        // Only proceed if there's something in the cart
        if (cart.length > 0) {
            
            // Calculate the total from the cart items
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            // Create a new order object from the cart data
            const newOrder = {
                orderId: "BF-" + Date.now().toString().slice(-7), // Simple unique ID
                date: new Date().toISOString().split('T')[0], // YYYY-MM-DD
                total: total,
                status: "Processing", // All new orders start as "Processing"
                items: cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price
                })),
                customerEmail: userEmail 
            };

            // Add the new order to the list of all orders
            orders.push(newOrder);

            // Save the updated orders list back to localStorage
            localStorage.setItem('bigfootOrders', JSON.stringify(orders));

            // Now that the order is saved, clear the cart
            localStorage.removeItem('bigfootCart');

            console.log("Order successfully created and cart cleared!");
        }
    </script>
</body>
</html>